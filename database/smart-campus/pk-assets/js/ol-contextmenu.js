/*!
 * ol-contextmenu - v3.1.0
 * Custom Context Menu for Openlayers
 * https://github.com/jonataswalker/ol-contextmenu
 * Built: Sat Nov 18 2017 09:49:39 GMT-0200 (-02)
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("openlayers")):"function"==typeof define&&define.amd?define(["openlayers"],e):t.ContextMenu=e(t.ol)}(this,function(t){"use strict";function e(t,e){if(void 0===e&&(e="Assertion failed"),!t){if("undefined"!=typeof Error)throw new Error(e);throw e}}function n(t){return/^\d+$/.test(t)}function s(t,e,n){if(Array.isArray(t))return void t.forEach(function(t){return s(t,e)});const i=Array.isArray(e)?e:e.split(/\s+/);let a=i.length;for(;a--;)o(t,i[a])||l(t,i[a],n)}function i(t,e,n){if(Array.isArray(t))return void t.forEach(function(t){return i(t,e,n)});const s=Array.isArray(e)?e:e.split(/\s+/);let a=s.length;for(;a--;)o(t,s[a])&&u(t,s[a],n)}function o(t,e){return t.classList?t.classList.contains(e):c(e).test(t.className)}function a(t,e,n){void 0===e&&(e=window.document);let s=/\./g,i=Array.prototype.slice,o=[];if(/^(#?[\w-]+|\.[\w-.]+)$/.test(t))switch(t[0]){case"#":o=[function(t){return t="#"===t[0]?t.substr(1,t.length):t,document.getElementById(t)}(t.substr(1))];break;case".":o=i.call(e.getElementsByClassName(t.substr(1).replace(s," ")));break;default:o=i.call(e.getElementsByTagName(t))}else o=i.call(e.querySelectorAll(t));return n?o:o[0]}function r(t){let e=document.createDocumentFragment(),n=document.createElement("div");for(n.innerHTML=t;n.firstChild;)e.appendChild(n.firstChild);return e}function c(t){return new RegExp("(^|\\s+) "+t+" (\\s+|$)")}function l(t,e,s){t.classList?t.classList.add(e):t.className=(t.className+" "+e).trim(),s&&n(s)&&window.setTimeout(function(){return u(t,e)},s)}function u(t,e,s){t.classList?t.classList.remove(e):t.className=t.className.replace(c(e)," ").trim(),s&&n(s)&&window.setTimeout(function(){return l(t,e)},s)}t=t&&t.hasOwnProperty("default")?t.default:t;var p={namespace:"ol-ctx-menu",container_class:"-container",separator_class:"-separator",submenu_class:"-submenu",hidden_class:"-hidden",icon_class:"-icon",zoom_in_class:"-zoom-in",zoom_out_class:"-zoom-out",ol_unselectable_class:"ol-unselectable"};const h=Object.freeze({namespace:"ol-ctx-menu",container_class:"-container",separator_class:"-separator",submenu_class:"-submenu",hidden_class:"-hidden",icon_class:"-icon",zoom_in_class:"-zoom-in",zoom_out_class:"-zoom-out",ol_unselectable_class:"ol-unselectable",default:p}),d={BEFOREOPEN:"beforeopen",OPEN:"open",CLOSE:"close",ADD_MENU_ENTRY:"add-menu-entry",CONTEXTMENU:"contextmenu",HOVER:"mouseover"},m={container:h.namespace+h.container_class,separator:h.namespace+h.separator_class,submenu:h.namespace+h.submenu_class,hidden:h.namespace+h.hidden_class,icon:h.namespace+h.icon_class,zoomIn:h.namespace+h.zoom_in_class,zoomOut:h.namespace+h.zoom_out_class,OL_unselectable:h.ol_unselectable_class},f={width:150,scrollAt:4,eventType:d.CONTEXTMENU,defaultItems:!0},y=[{text:"Zoom In",classname:m.zoomIn+" "+m.icon,callback:function(t,e){const n=e.getView();n.animate({zoom:+n.getZoom()+1,duration:700,center:t.coordinate})}},{text:"Zoom Out",classname:m.zoomOut+" "+m.icon,callback:function(t,e){const n=e.getView();n.animate({zoom:+n.getZoom()-1,duration:700,center:t.coordinate})}}];var b=function(t){return this.Base=t,this.map=void 0,this.viewport=void 0,this.coordinateClicked=void 0,this.pixelClicked=void 0,this.lineHeight=0,this.items={},this.opened=!1,this.submenu={left:t.options.width-15+"px",lastLeft:""},this.eventHandler=this.handleEvent.bind(this),this};b.prototype.init=function(t){this.map=t,this.viewport=t.getViewport(),this.setListeners(),this.Base.Html.createMenu(),this.lineHeight=this.getItemsLength()>0?this.Base.container.offsetHeight/this.getItemsLength():this.Base.Html.cloneAndGetLineHeight()},b.prototype.getItemsLength=function(){var t=this;let e=0;return Object.keys(this.items).forEach(function(n){t.items[n].submenu||t.items[n].separator||e++}),e},b.prototype.getPixelClicked=function(){return this.pixelClicked},b.prototype.getCoordinateClicked=function(){return this.coordinateClicked},b.prototype.positionContainer=function(t){var e=this;const n=this.Base.container,s=this.map.getSize(),o=s[1]-t[1],r=s[0]-t[0],c={w:n.offsetWidth,h:Math.round(this.lineHeight*this.getItemsLength())},l=a("li."+m.submenu+">div",n,!0);r>=c.w?(n.style.right="auto",n.style.left=t[0]+5+"px"):(n.style.left="auto",n.style.right="15px"),o>=c.h?(n.style.bottom="auto",n.style.top=t[1]-10+"px"):(n.style.top="auto",n.style.bottom=0),i(n,m.hidden),l.length&&(this.submenu.lastLeft=r<2*c.w?"-"+c.w+"px":this.submenu.left,l.forEach(function(t){const n={w:window.innerWidth||document.documentElement.clientWidth,h:window.innerHeight||document.documentElement.clientHeight},s=function(t){const e=t.getBoundingClientRect(),n=document.documentElement;return{left:e.left+window.pageXOffset-n.clientLeft,top:e.top+window.pageYOffset-n.clientTop,width:t.offsetWidth,height:t.offsetHeight}}(t),i=s.height;let a=o-i;a<0&&(a=i-(n.h-s.top),t.style.top="-"+a+"px"),t.style.left=e.submenu.lastLeft}))},b.prototype.openMenu=function(t,e){this.Base.dispatchEvent({type:d.OPEN,pixel:t,coordinate:e}),this.opened=!0,this.positionContainer(t)},b.prototype.closeMenu=function(){this.opened=!1,s(this.Base.container,m.hidden),this.Base.dispatchEvent({type:d.CLOSE})},b.prototype.setListeners=function(){this.viewport.addEventListener(this.Base.options.eventType,this.eventHandler,!1)},b.prototype.removeListeners=function(){this.viewport.removeEventListener(this.Base.options.eventType,this.eventHandler,!1)},b.prototype.handleEvent=function(t){const e=this;this.coordinateClicked=this.map.getEventCoordinate(t),this.pixelClicked=this.map.getEventPixel(t),this.Base.dispatchEvent({type:d.BEFOREOPEN,pixel:this.pixelClicked,coordinate:this.coordinateClicked}),this.Base.disabled||(this.Base.options.eventType===d.CONTEXTMENU&&(t.stopPropagation(),t.preventDefault()),this.openMenu(this.pixelClicked,this.coordinateClicked),t.target.addEventListener("mousedown",{handleEvent:function(n){e.closeMenu(),t.target.removeEventListener(n.type,this,!1)}},!1))},b.prototype.setItemListener=function(t,e){const n=this;t&&"function"==typeof this.items[e].callback&&function(s){t.addEventListener("click",function(t){t.preventDefault();const i={coordinate:n.getCoordinateClicked(),data:n.items[e].data||null};n.closeMenu(),s(i,n.map)},!1)}(this.items[e].callback)};var g=function(t){return this.Base=t,this.Base.container=this.container=this.createContainer(),this};g.prototype.createContainer=function(t){const e=document.createElement("div"),n=document.createElement("ul"),s=[m.container,m.OL_unselectable];return t&&s.push(m.hidden),e.className=s.join(" "),e.style.width=parseInt(this.Base.options.width,10)+"px",e.appendChild(n),e},g.prototype.createMenu=function(){let t=[];if("items"in this.Base.options?t=this.Base.options.defaultItems?this.Base.options.items.concat(y):this.Base.options.items:this.Base.options.defaultItems&&(t=y),0===t.length)return!1;t.forEach(this.addMenuEntry,this)},g.prototype.addMenuEntry=function(t){var e=this;if(t.items&&Array.isArray(t.items)){t.classname=t.classname||"",function(t,e){return!!~e.indexOf(t)}(m.submenu,t.classname)||(t.classname=t.classname.length?" "+m.submenu:m.submenu);let n=this.generateHtmlAndPublish(this.container,t),s=this.createContainer();s.style.left=this.Base.Internal.submenu.lastLeft||this.Base.Internal.submenu.left,n.appendChild(s),t.items.forEach(function(t){e.generateHtmlAndPublish(s,t,!0)})}else this.generateHtmlAndPublish(this.container,t)},g.prototype.generateHtmlAndPublish=function(t,e,n){let s,i,o,a=!1;const c="_"+Math.random().toString(36).substr(2,9);return"string"==typeof e&&"-"===e.trim()?(i=r(s=['<li id="',c,'" class="',m.separator,'">',"<hr></li>"].join("")),o=[].slice.call(i.childNodes,0)[0],t.firstChild.appendChild(i),a=!0):(e.classname=e.classname||"",i=r(s="<span>"+e.text+"</span>"),o=document.createElement("li"),e.icon&&(""===e.classname?e.classname=m.icon:-1===e.classname.indexOf(m.icon)&&(e.classname+=" "+m.icon),o.setAttribute("style","background-image:url("+e.icon+")")),o.id=c,o.className=e.classname,o.appendChild(i),t.firstChild.appendChild(o)),this.Base.Internal.items[c]={id:c,submenu:n||0,separator:a,callback:e.callback,data:e.data||null},this.Base.Internal.setItemListener(o,c),o},g.prototype.removeMenuEntry=function(t){const e=a("#"+t,this.container.firstChild);e&&this.container.firstChild.removeChild(e),delete this.Base.Internal.items[t]},g.prototype.cloneAndGetLineHeight=function(){const t=this.container.cloneNode(),e=r("<span>Foo</span>"),n=r("<span>Foo</span>"),s=document.createElement("li"),i=document.createElement("li");s.appendChild(e),i.appendChild(n),t.appendChild(s),t.appendChild(i),this.container.parentNode.appendChild(t);const o=t.offsetHeight/2;return this.container.parentNode.removeChild(t),o};return function(n){function s(t){void 0===t&&(t={}),e("object"==typeof t,"@param `opt_options` should be object type!"),this.options=function(t,e){let n={};for(let e in t)n[e]=t[e];for(let t in e)n[t]=e[t];return n}(f,t),this.disabled=!1,this.Internal=new b(this),this.Html=new g(this),n.call(this,{element:this.container})}return n&&(s.__proto__=n),s.prototype=Object.create(n&&n.prototype),s.prototype.constructor=s,s.prototype.clear=function(){Object.keys(this.Internal.items).forEach(this.Html.removeMenuEntry,this.Html)},s.prototype.close=function(){this.Internal.closeMenu()},s.prototype.enable=function(){this.disabled=!1},s.prototype.disable=function(){this.disabled=!0},s.prototype.getDefaultItems=function(){return y},s.prototype.countItems=function(){return Object.keys(this.Internal.items).length},s.prototype.extend=function(t){e(Array.isArray(t),"@param `arr` should be an Array."),t.forEach(this.push,this)},s.prototype.isOpen=function(){return this.Internal.opened},s.prototype.updatePosition=function(t){e(Array.isArray(t),"@param `pixel` should be an Array."),this.isOpen()&&this.Internal.positionContainer(t)},s.prototype.pop=function(){const t=Object.keys(this.Internal.items);this.Html.removeMenuEntry(t[t.length-1])},s.prototype.push=function(t){e(function(t){return null!=t}(t),"@param `item` must be informed."),this.Html.addMenuEntry(t)},s.prototype.shift=function(){this.Html.removeMenuEntry(Object.keys(this.Internal.items)[0])},s.prototype.setMap=function(e){t.control.Control.prototype.setMap.call(this,e),e?this.Internal.init(e,this):this.Internal.removeListeners()},s}(t.control.Control)});
